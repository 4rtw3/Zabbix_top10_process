# Add these lines to your zabbix_agentd.conf file
# Usually located at C:\Program Files\Zabbix Agent\zabbix_agentd.conf

# Enable user parameters and remote commands
EnableRemoteCommands=1
UnsafeUserParameters=1

# User parameters for top 10 CPU processes monitoring on Windows
# Using powershell.exe to execute PowerShell scripts

# UserParameter=system.processes.top10.discovery,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\top10_cpu.ps1"

UserParameter=system.processes.pid0,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 0 "PID"
UserParameter=system.processes.pname0,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 0 "Name"
UserParameter=system.processes.cpu0,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 0 "CPU"
UserParameter=system.processes.memory0,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 0 "Memory(MB)"

UserParameter=system.processes.pid1,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 1 "PID"
UserParameter=system.processes.pname1,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 1 "Name"
UserParameter=system.processes.cpu1,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 1 "CPU"
UserParameter=system.processes.memory1,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 1 "Memory(MB)"

UserParameter=system.processes.pid2,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 2 "PID"
UserParameter=system.processes.pname2,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 2 "Name"
UserParameter=system.processes.cpu2,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 2 "CPU"
UserParameter=system.processes.memory2,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 2 "Memory(MB)"

UserParameter=system.processes.pid3,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 3 "PID"
UserParameter=system.processes.pname3,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 3 "Name"
UserParameter=system.processes.cpu3,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 3 "CPU"
UserParameter=system.processes.memory3,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 3 "Memory(MB)"

UserParameter=system.processes.pid4,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 4 "PID"
UserParameter=system.processes.pname4,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 4 "Name"
UserParameter=system.processes.cpu4,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 4 "CPU"
UserParameter=system.processes.memory4,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 5 "Memory(MB)"

UserParameter=system.processes.pid5,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 5 "PID"
UserParameter=system.processes.pname5,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 5 "Name"
UserParameter=system.processes.cpu5,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 5 "CPU"
UserParameter=system.processes.memory5,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 5 "Memory(MB)"

UserParameter=system.processes.pid6,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 6 "PID"
UserParameter=system.processes.pname6,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 6 "Name"
UserParameter=system.processes.cpu6,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 6 "CPU"
UserParameter=system.processes.memory6,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 6 "Memory(MB)"

UserParameter=system.processes.pid7,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 7 "PID"
UserParameter=system.processes.pname7,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 7 "Name"
UserParameter=system.processes.cpu7,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 7 "CPU"
UserParameter=system.processes.memory7,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 7 "Memory(MB)"

UserParameter=system.processes.pid8,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 8 "PID"
UserParameter=system.processes.pname8,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 8 "Name"
UserParameter=system.processes.cpu8,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 8 "CPU"
UserParameter=system.processes.memory8,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 8 "Memory(MB)"

UserParameter=system.processes.pid9,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 9 "PID"
UserParameter=system.processes.pname9,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 9 "Name"
UserParameter=system.processes.cpu9,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 9 "CPU"
UserParameter=system.processes.memory9,powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\Zabbix Agent\scripts\read_data.ps1" 9 "Memory(MB)"


